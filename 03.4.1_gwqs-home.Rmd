---
title: "0.3.4.1_gwqs-home"
author: "Jagadeesh Puvvula"
date: "2023-02-18"
output: pdf_document
---

```{r, echo=FALSE, message=FALSE}
library(tidyverse)
library(janitor)
library(gWQS)
options(scipen = 999)
```


```{r, echo=FALSE, message=FALSE}
dat<- read_csv("E:/BBK17/pj/wppsi_exp_out_comb/wppsi_fin.csv") |>
  mutate_if(is.numeric, round, 4) |>
  filter(cohort=="1")|>
  drop_na() |>
  clean_names() |>
  rename(Pb=pbsg, Hg=hgsg, DMA=dma_sg, DDE= dde_lp, PBDE_47 = pbde47_lp,
         PCB_118=pcb118_lp, PCB_138=pcb138_lp, PCB_153=pcb153_lp,
         PCB_180=pcb180_lp, PFHxS=pf_hx_spl, PFOA=pfoapl, PFOS=pfospl,
         BCEtP=bcetp_sg, BDCPP=bdcpp_sg, DBuP=dbup_sg, DPhP=dphp_sg,
         TCS=tcs_sg, BPA=bpa_sg, MBP=mbp_sg, MBZP=mbzp_sg, MCPP=mcpp_sg,
         sigma_DEHP=dehp, MEP=mep_sg, MIBP=mibp_sg, di_Ethyl_OP=op_de,
         di_Methyl_OP=op_dm, B_PB=b_pb, M_PB=m_pb, P_PB=p_pb)|>
  select(c(Pb, Hg, DMA, DDE, PBDE_47, PCB_118, PCB_138, PCB_153, PCB_180,
          PFHxS, PFOA, PFOS, BCEtP, BDCPP, DBuP, DPhP, TCS, BPA, MBP, MBZP,
          MCPP, sigma_DEHP, MEP, MIBP, di_Ethyl_OP, di_Methyl_OP, 
          B_PB, M_PB, P_PB, wppsi_fsiq, wppsi_viq, wppsi_piq, cohort, city,
          sex, race_bin, cotinine, mom_edu_cat, home_score_total, parity_n, mom_age)) 

dat<- dat |> 
  mutate(across(all_of(c("cohort", "city", "sex", "race_bin", 
                         "parity_n", "mom_edu_cat")), as.factor))
str(dat)
```


```{r, echo=FALSE, message=FALSE}
mixture<- names(dat[c(1:29)])

dat<- dat |>
  mutate(wppsi_fsiq_lg = log(wppsi_fsiq),
         wppsi_piq_lg = log(wppsi_piq),
         wppsi_viq_lg= log(wppsi_viq))

```

FISQ - ALL - Negative direction - unconstrained model - No bootstrap
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#No bootstrap 
nb_fsiq_neg <- gwqs(wppsi_fsiq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                 home_score_total+parity_n+mom_age, mix_name = mixture,
               data = dat, validation = 0.6, b=100, b1_pos = F,b1_constr = F,
               family = "gaussian", seed = 2023)

save(nb_fsiq_neg, file = "E:/BBK17/pj/wppsi_results/gwqs/home/nb_fsiq_neg.rda")
summary(nb_fsiq_neg)  
gwqs_barplot(nb_fsiq_neg) 
gwqs_scatterplot(nb_fsiq_neg)

```

FSIQ - ALL - Negative direction - unconstrained model - with repeated holdout
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#100 bootstraps and 100 repeated holdouts 
rh_fsiq_neg <- gwqsrh(wppsi_fsiq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                 home_score_total+parity_n+mom_age, mix_name = mixture,
               data = dat,
                q=10, validation=0.5,b=100,b1_pos = F,b1_constr = F,
                family="gaussian",seed=2023, rh=100)

save(rh_fsiq_neg, file = "E:/BBK17/pj/wppsi_results/gwqs/home/rh_fsiq_neg.rda")
summary(rh_fsiq_neg)  
gwqsrh_boxplot(rh_fsiq_neg)

```

FISQ - ALL - Positive direction - unconstrained model - No bootstrap
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#No bootstrap 
nb_fsiq_pos <- gwqs(wppsi_fsiq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                 home_score_total+parity_n+mom_age, mix_name = mixture,
               data = dat, validation = 0.6, b=100, b1_pos = T,b1_constr = F,
               family = "gaussian", seed = 2023)

save(nb_fsiq_pos, file = "E:/BBK17/pj/wppsi_results/gwqs/home/nb_fsiq_pos.rda")
summary(nb_fsiq_pos)  
gwqs_barplot(nb_fsiq_pos) 
gwqs_scatterplot(nb_fsiq_pos)

```

FISQ - ALL - Positive direction - unconstrained model - with repeated holdout
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#100 bootstraps and 100 repeated holdouts 
rh_fsiq_pos <- gwqsrh(wppsi_fsiq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                 home_score_total+parity_n+mom_age, mix_name = mixture,
               data = dat,
                q=10, validation=0.6,b=100,b1_pos = T,b1_constr = F,
                family="gaussian",seed=2023, rh=100)

save(rh_fsiq_pos, file = "E:/BBK17/pj/wppsi_results/gwqs/home/rh_fsiq_pos.rda")
summary(rh_fsiq_pos)  
gwqsrh_boxplot(rh_fsiq_pos)

```

==============================================================================

viq - ALL - Negative direction - unconstrained model - No bootstrap
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#No bootstrap 
nb_viq_neg <- gwqs(wppsi_viq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                      home_score_total+parity_n+mom_age, mix_name = mixture,
                    data = dat, validation = 0.6, b=100, b1_pos = F,b1_constr = F,
                    family = "gaussian", seed = 2023)

save(nb_viq_neg, file = "E:/BBK17/pj/wppsi_results/gwqs/home/nb_viq_neg.rda")
summary(nb_viq_neg)  
gwqs_barplot(nb_viq_neg) 
gwqs_scatterplot(nb_viq_neg)

```

viq - ALL - Negative direction - unconstrained model - with repeated holdout
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#100 bootstraps and 100 repeated holdouts 
rh_viq_neg <- gwqsrh(wppsi_viq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                        home_score_total+parity_n+mom_age, mix_name = mixture,
                      data = dat,
                      q=10, validation=0.6,b=100,b1_pos = F,b1_constr = F,
                      family="gaussian",seed=2023, rh=100)

save(rh_viq_neg, file = "E:/BBK17/pj/wppsi_results/gwqs/home/rh_viq_neg.rda")
summary(rh_viq_neg)  
gwqsrh_boxplot(rh_viq_neg)

```

viq - ALL - Positive direction - unconstrained model - No bootstrap
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#No bootstrap 
nb_viq_pos <- gwqs(wppsi_viq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                     home_score_total+parity_n+mom_age, mix_name = mixture,
                   data = dat, validation = 0.6, b=100, b1_pos = T,b1_constr = F,
                   family = "gaussian", seed = 2023)

save(nb_viq_pos, file = "E:/BBK17/pj/wppsi_results/gwqs/home/nb_viq_pos.rda")
summary(nb_viq_pos)  
gwqs_barplot(nb_viq_pos) 
gwqs_scatterplot(nb_viq_pos)

```

viq - ALL - Positive direction - unconstrained model - with repeated holdout
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#100 bootstraps and 100 repeated holdouts 
rh_viq_pos <- gwqsrh(wppsi_viq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                       home_score_total+parity_n+mom_age, mix_name = mixture,
                     data = dat,
                     q=10, validation=0.6,b=100,b1_pos = T,b1_constr = F,
                     family="gaussian",seed=2023, rh=100)

save(rh_viq_pos, file = "E:/BBK17/pj/wppsi_results/gwqs/home/rh_viq_pos.rda")
summary(rh_viq_pos)  
gwqsrh_boxplot(rh_viq_pos)

```

==============================================================================

piq - ALL - Negative direction - unconstrained model - No bootstrap
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#No bootstrap 
nb_piq_neg <- gwqs(wppsi_piq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                     home_score_total+parity_n+mom_age, mix_name = mixture,
                   data = dat, validation = 0.6, b=100, b1_pos = F,b1_constr = F,
                   family = "gaussian", seed = 2023)

save(nb_piq_neg, file = "E:/BBK17/pj/wppsi_results/gwqs/home/nb_piq_neg.rda")
summary(nb_piq_neg)  
gwqs_barplot(nb_piq_neg) 
gwqs_scatterplot(nb_piq_neg)

```

piq - ALL - Negative direction - unconstrained model - with repeated holdout
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#100 bootstraps and 100 repeated holdouts 
rh_piq_neg <- gwqsrh(wppsi_piq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                       home_score_total+parity_n+mom_age, mix_name = mixture,
                     data = dat,
                     q=10, validation=0.6,b=100,b1_pos = F,b1_constr = F,
                     family="gaussian",seed=2023, rh=100)

save(rh_piq_neg, file = "E:/BBK17/pj/wppsi_results/gwqs/home/rh_piq_neg.rda")
summary(rh_piq_neg)  
gwqsrh_boxplot(rh_piq_neg)

```

piq - ALL - positive direction - unconstrained model - No bootstrap
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#No bootstrap 
nb_piq_pos <- gwqs(wppsi_piq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                     home_score_total+parity_n+mom_age, mix_name = mixture,
                   data = dat, validation = 0.6, b=100, b1_pos = T,b1_constr = F,
                   family = "gaussian", seed = 2023)

save(nb_piq_pos, file = "E:/BBK17/pj/wppsi_results/gwqs/home/nb_piq_pos.rda")
summary(nb_piq_pos)  
gwqs_barplot(nb_piq_pos) 
gwqs_scatterplot(nb_piq_pos)

```

piq - ALL - Negative direction - unconstrained model - with repeated holdout
```{r, echo=FALSE, message=FALSE, fig.height=12, fig.width=12, dpi=300}
#100 bootstraps and 100 repeated holdouts 
rh_piq_pos <- gwqsrh(wppsi_piq_lg ~wqs+sex+race_bin+cotinine+mom_edu_cat+
                       home_score_total+parity_n+mom_age, mix_name = mixture,
                     data = dat,
                     q=10, validation=0.6,b=100,b1_pos = T,b1_constr = F,
                     family="gaussian",seed=2023, rh=100)

save(rh_piq_pos, file = "E:/BBK17/pj/wppsi_results/gwqs/home/rh_piq_pos.rda")
summary(rh_piq_pos)  
gwqsrh_boxplot(rh_piq_pos)

```
